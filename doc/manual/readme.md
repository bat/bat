Build
-----

### high level

go to `doc/`:

    make ref-guide # output in ref-guide/html
    make manual # output in ref-guide/html and BAT-manual.pdf

in `doc/ref-guide`

    make doxy

in `doc/manual`

    make doxy # html
    make pdf  # pdflatex

Point to a local copy of mathjax

    export MATHJAX_RELPATH=/usr/share/javascript/mathjax/
    make manual

### details

create the reference guide first to create a tag file that is referenced from the manual

To make latex recognize `\newcommand`, add it to `doc/bat.sty`, it is copied by the makefile to th latex subdirectory

To define the same commands also for mathjax, follow http://stackoverflow.com/questions/40270302 and add something to `doc/newcommands.js`

adding content
--------------

### chapter

Create file `chapter3.md`, add in the proper location in `$doxyinput` in `Makefile.am`

     input = front.md basics.md bayes.md chapter3.md

Copy over the labeling of sections from `bayes.md`, it doesn't match the doxygen docs on markdown. Add `[TOC]` for a table of contents!

``` markdown
Markov chain Monte Carlo {#cha-MCMC}
============

[TOC]

```

### section

Unfortunately markdown syntax with a label to appear in the TOC doesn't work despite what the manual says, so we have to use doxygen syntax

    @section sec-mcmc-motiv Motivation

Section w/o a label don't appear in the TOC as no link can be established, so every section should have a link!

### subsection

Here markdown ok again

    ## Factorized proposal {#sec-factorized}


### link to next/previous page

doxygen doesn't do this automatically. we can do

    @ref cha-basics

but that doesn't look good. Rather define a HTML structure and style it with css

doxygen does this in its own documentation. Let's see if we can find out how. Perhapse use `@htmlonly`, see below.

### images

From inkscape, export to png for html output with

    inkscape --export-area-drawing --export-png=random-walk.png --export-width 500 random-walk.svg

For every image that is autogenerated, add a rule to `manual/figures/Makefile`.

The markdown image support is not good enough for us, so import images separately for html and latex. Forcibly add both images to git! Also add them to `EXTRA_DIST` in `doc/manual/Makefile.am`

Keep the caption in `""` short because it doesn't look good in HTML and avoid math as mathjax fails in caption. Unfortunately caption has to be copied

    @anchor random-walk-2D
    @image html random-walk.png "2D random walk."
    @image latex random-walk.pdf "2D random walk." width=0.5\textwidth

Refer to the image with

    @ref random-walk-2D "2D example plot"

### copying from introduction.tex

use pandoc to convert to markdown

    pandoc introduction.tex -t markdown -o introduction.md

It's left for emacs regex to translate math expressions

    \$\([[:ascii:]]+?\)\$ -> \\f$\1\\f$ # inline math
    \$\$\\begin{\(.+?\)}\([[:ascii:]]+?\)\\end{.+?}\$\$ -> ^J\\f{\1}{\2^J\\f}^J) # display math

pandoc uses aligned everywhere and doesn't respect the math environment chosen, so check if outlooks ok, else reinstate what was there before

    {aligned} -> {eqnarray}

Unlabelled section can stay as they are. Convert subsections that have a label.

    ^### \(.+?\) {#\(.+?\)}^J-*$ -> @section \2 \1

Labels may not contain `:` for doxygen

    ^@section section:\(.+? \)\(.+?\)$ -> @section sec-mtf-\1 \2


output specific code
----------

    @htmlonly
    some text only visible in the html output
    @endhtmlonly

    @latexonly
    some text only visible in the latex output
    @endlatexonly

### source code examples

Syntax highlighting (and linking in html) with

    @code{.cpp}
    double GetLogPrior(double x)
    {
        return -0.5 * (x - fMean) * (x - fMean) / fSigma / fSigma - log(fSigma) - 0.5 * log(2 * M_PI);
    }
    @endcode

debugging doxygen
-----------------

    doxygen Doxyfile -d

changing the output style
------------------------

https://www.stack.nl/~dimitri/doxygen/manual/customize.html

### latex

Modify `bat.sty` which is loaded in the preamble.

Todo: `### foo` and `#### bar` look the same, they shouldn't. latex `paragraph` -> `####`

### html

Change names of tabs in `DoxygenLayout.xml`, CSS in
`customdoxygen.css`. We use the twitter bootstrap layout from
https://github.com/Velron/doxygen-bootstrapped defined in javascript
in `doxy-boot.js`.

Warning: a few markups like `@see` and the bibliography are only
displayed in pdf not in html. I still need to figure out how to make
this work with bootstrap. Seems to be a general problem
https://github.com/Velron/doxygen-bootstrapped/issues/21
